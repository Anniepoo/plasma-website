# vim: noet sw=4 ts=4

.PHONY : all
all : \
		images/icons/blocked-21.png \
		images/icons/done-21.png \
		images/icons/todo-21.png \
		images/icons/wip-21.png \
		images/logo-64.png \
		images/sun-200.png \
		images/sunt-200.png \
		docs
	jekyll b

.PHONY : serve
serve : all
	jekyll s

images/icons/todo-21.png: _images-original/todo.png images/icons
	convert $< -resize 21x21 $@
images/icons/done-21.png: _images-original/done.png images/icons
	convert $< -resize 21x21 $@
images/icons/blocked-21.png: _images-original/blocked.png images/icons
	convert $< -resize 21x21 $@
images/icons/wip-21.png: _images-original/wip.png images/icons
	convert $< -resize 21x21 $@

images/logo-64.png: _images-original/logo.png images
	convert $< -resize 64x64 $@
images/sun-200.png: _images-original/sun.png images
	convert $< -resize 200x200 $@
images/sunt-200.png: _images-original/sunt.png images
	convert $< -resize 200x200 $@

images/working.jpeg: _images-original/working.jpeg images
	cp $< $@

images/icons:
	mkdir -p $@

images:
	mkdir -p $@

.PHONY: docs
docs: docs/index.html \
	docs/pz_format.html \
	docs/pz_machine.html \
	docs/plasma_ref.html \
	docs/C_style.html \
	docs/Mercury_style.html \
	docs/references.html \
	docs/todo.html

docs/index.txt:
	cp ../plasma/docs/index.txt $@
docs/pz_format.txt:
	cp ../plasma/docs/pz_format.txt $@
docs/pz_machine.txt:
	cp ../plasma/docs/pz_machine.txt $@
docs/plasma_ref.txt:
	cp ../plasma/docs/plasma_ref.txt $@
docs/C_style.txt:
	cp ../plasma/docs/C_style.txt $@
docs/Mercury_style.txt:
	cp ../plasma/docs/Mercury_style.txt $@
docs/references.txt:
	cp ../plasma/docs/references.txt $@
docs/todo.txt:
	cp ../plasma/docs/todo.txt $@

%.html : %.txt docs/_asciidoc.conf
	asciidoc --conf-file docs/_asciidoc.conf -o $@ $<

.PHONY: clean
clean:
	rm -rf images _site docs/*.txt docs/*.html

.PHONY: upload
upload: all
	rsync -crv --del _site/ champagne:/srv/www/plasmalang/

